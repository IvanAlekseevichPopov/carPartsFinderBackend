version: '3'

services:
  php:
    build: docker/dev/php
    depends_on:
      - database
    volumes:
      - .:/var/www/html
      - trash:/var/www/
    expose:
      - "9000"
  nginx:
    image: nginx
    depends_on:
      - php
    ports:
      - "80:80"
    volumes:
      - .:/var/www/html
      - ./var/log:/var/log/nginx
      - ./docker/dev/nginx/symfony.conf:/etc/nginx/conf.d/default.conf

###> doctrine/doctrine-bundle ###
  database:
    image: postgres:14
    environment:
      POSTGRES_DB: dev
      POSTGRES_PASSWORD: dev
      POSTGRES_USER: dev
    ports:
      - "5432:5432"
###< doctrine/doctrine-bundle ###

###> symfony/mailer ###
  mailer:
    image: schickling/mailcatcher
    ports: [1025, 1080]
###< symfony/mailer ###

###> blackfireio/blackfire-symfony-meta ###
#  blackfire:
#    image: blackfire/blackfire:2
#    # uncomment to store Blackfire credentials in a local .env.local file
#    #env_file: .env.local
#    environment:
#      BLACKFIRE_LOG_LEVEL: 4
#    ports: [8307]
###< blackfireio/blackfire-symfony-meta ###

volumes:
  trash: